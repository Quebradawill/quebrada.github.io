---
layout: post
title: 研习U-Net
date: 2019-09-16
categories: Deep-Learning
tags: U-Net
status: publish
type: post
published: true
author: Quebradawill
---

### 1. 铺垫

在计算机视觉领域，全卷积网络（FCN）是比较有名的图像分割网络，医学图像处理方向，U-Net 可以说是一个更加炙手可热的网络，基本上所有的分割问题，我们都会拿 U-Net 先看一下基本的结果，然后进行“魔改”。

U-Net 和 FCN 非常相似，U-Net 比 FCN 稍晚提出来，但都发表在 2015 年，和 FCN 相比，U-Net 的第一个特点是**完全对称**，也就是左边和右边是很类似的，而 FCN 的 decoder 相对简单，只用了一个 deconvolution 的操作，之后并没有跟上卷积结构。第二个区别就是 **skip connection**，FCN 用的是加操作（summation），U-Net 用的是叠操作（concatenation）。这些都是细节，重点是它们的结构用了一个比较经典的思路，也就是**编码**和**解码**（encoder-decoder），早在 2006 年就被 Hinton 大神提出来发表在了 nature 上。

当时这个结构的提出主要作用并不是分割，而是压缩图像和去噪声。输入一幅图，经过下采样的编码，得到一串比原先图像更小的特征，相当于压缩，然后再经过一个解码，理想状况是能还原到原来的图像。这样的话我们存一幅图的时候就只需要存一个特征和一个解码器即可。这个想法我个人认为是很漂亮了。同理，这个思路也可以用在原图像去噪，做法就是在训练的阶段在原图人为加上噪声，然后放到这个编码解码器中，目标是可以还原得到原图。（<font color='blue'>此处的去噪如何理解？</font>）

后来这个思路被用在了图像分割的问题上，也就是现在我们看到的 U-Net 结构，在它被提出的三年中，有很多很多的论文去讲如何改进 U-Net 或者 FCN，不过这个分割网络本质的拓扑结构是没有改动的。举例来说，去年 ICCV 上凯明大神提出的 Mask RCNN ，相当于一个检测，分类，分割的集大成者，我们仔细去看它的分割部分，其实使用的也就是这个简单的 FCN 结构。说明了这种“U 形”的编码解码结构确实非常简洁，并且最关键的一点是好用。

简单的过一下这个网红结构，我们先提取出它的拓扑结构，这样会比较容易分析它的实质，排除很多细节的干扰。

输入是一幅图，输出是目标的分割结果。继续简化就是，一幅图，编码，或者说降采样，然后解码，也就是升采样，然后输出一个分割结果。根据结果和真实分割的差异，反向传播来训练这个分割网络。我们可以说，U-Net 里面最精彩的部分就是这三部分：

- 下采样
- 上采样
- skip connection

### 2. 展开

在这三年中，U-Net 得到的超过 2500 次的引用，FCN 接近 6000 次的引用，大家都在做什么样的改进？如果让你在这个经典的结构基础上改进，你会去关注哪些点呢？

首先一个问题是：**要多深合适？**

这里我想强调的一点是，很多论文给出了他们建议的网络结构，其中包括非常多的细节，比如用什么卷积，用几层，怎么降采样，学习率多少，优化器用什么，这些都是比较直观的参数，其实这些在论文中给出参数并不见得是最好的，所以关注这些的意义不大，**一个网络结构，我们真正值得关注的是它的设计传达了什么信息。**就拿 U-Net 来说，原论文给出的结构是原图经过**四次降采样**，**四次上采样**，得到分割结果，实际呢，为什么四次？就是作者喜欢呗，或者说当时作者使用的数据集，四次降采样的效果好，我们也可以再更专业一点，四次降采样的接受域或者感受野大小正合适处理图像。或者四次降采样比较适合输入图像的尺寸等等，理由一堆，但是你们真的相信吗？不见得吧。

我先给一个 2017 年在 CVPR 上发表的一个名叫 [PSPNet](https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1612.01105) 的分割网络，你会发现，好像整体的架构和 U-Net 还是像的，只是降采样的数目减小了，当然，他们也针对性地增强了中间的特征抓取环节的复杂性。











参考：[研习U-Net](https://zhuanlan.zhihu.com/p/44958351)